<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>东京房价预测-ver3.0</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 0 20px;
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h2 {
            margin-bottom: 10px;
            text-align: center;
            width: 100%;
        }
        .chart h2 {
            margin-bottom: 5px; /* 确保标题与图表内容之间有间距 */
        }
        .form-result-container {
            margin-top: 20px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            gap: 20px;
            align-items: stretch; /* 使子元素高度一致 */
        }
        .form-container {
            width: 48%;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            background-color: #fff;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            flex: 1; 
        }
        .result-container {
            width: 48%;
            overflow-y: auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            background-color: #fff;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            height: auto; /* 确保容器高度自适应内容 */
            flex: 1; /* 使容器在flex布局中占据相同的高度 */
            max-height:1000px
        }
        form {
            display: flex;
            flex-direction: column;
        }
        input, select, button {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        button {
            background-color: #007bff;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #0056b3;
        }
        .prediction {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
            color: #d9534f; /* Highlight color */
            text-align: center;
        }
        .result {
            text-align: center;
            margin-top: 1px;
        }
        .charts-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-left: 20px; /* 设置图表的左外边距 */
            margin-right: 20px; /* 设置图表的右外边距 */
        }
        .chart {
            margin-bottom: 5px;
            width: 97%;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            background-color: #fff;
        }
        .table-container {
            width: 100%;
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f4f4f9;
        }
        .footer-text {
            text-align: center;
            font-size: 14px;
            width: 100%;
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var citySelect = document.getElementById('city');
            var districtSelect = document.getElementById('district');

            citySelect.addEventListener('change', function() {
                var selectedCity = this.value;
                districtSelect.innerHTML = '<option value="">请选择地区名</option>';
                if (selectedCity && cityToDistricts[selectedCity]) {
                    cityToDistricts[selectedCity].forEach(function(district) {
                        var option = new Option(district, district);
                        districtSelect.add(option);
                    });
                }
            });
        });

        var cityToDistricts = {{ city_to_districts | tojson }};
        function validateForm() {
            const form = document.forms['myForm'];
            const requiredFields = ['distance', 'area', 'coverage', 'volume_rate', 'age'];

            for (let field of requiredFields) {
                if (!form[field].value) {
                    alert('请填写所有必填字段。');
                    return false;
                }

                if (isNaN(form[field].value)) {
                    alert('请确保所有数值字段均为有效数字。');
                    return false;
                }
            }

            return true;
        }
    </script>
</head>
<body>
    <div class="container">
        <h2>Tokyo HousePrice Predictor - Ver3.0</h2>
        <div class="form-result-container">
            <div class="form-container">
                <form name="myForm" method="post" onsubmit="return validateForm()">
                </select><br>
                模型版本:
                <select name="model_version" required>
                    <option value="v1" {% if request.form['model_version'] == 'v1' %}selected{% endif %}>v1</option>
                    <option value="v2" {% if request.form['model_version'] == 'v2' %}selected{% endif %}>v2</option>
                    <option value="v3" {% if request.form['model_version'] == 'v3' %}selected{% endif %}>v3</option>
                </select><br>
                    最寄駅：距離: <input type="text" name="distance" value="{{ request.form['distance'] if 'distance' in request.form else '' }}" required><br>
                    面積（㎡）: <input type="text" name="area" value="{{ request.form['area'] if 'area' in request.form else '' }}" required><br>
                    建物の構造: 
                    <select name="structure" required>
                        {% for structure in ['ＲＣ', 'ＳＲＣ', '鉄骨造', '木造', '軽量鉄骨造', '鉄骨造、軽量鉄骨造', 'ＳＲＣ、鉄骨造', 'ブロック造', 'ＳＲＣ、ＲＣ', '鉄骨造、木造', 'ＲＣ、鉄骨造、木造', 'ＲＣ、ブロック造', 'ＲＣ、木造', 'ＲＣ、鉄骨造', '木造、ブロック造', 'ＲＣ、軽量鉄骨造', '木造、軽量鉄骨造', 'ＲＣ、木造、ブロック造', 'ＳＲＣ、木造', 'ブロック造、軽量鉄骨造', '鉄骨造、木造、軽量鉄骨造', '鉄骨造、ブロック造', 'ＲＣ、鉄骨造、木造、ブロック造', 'ＲＣ、鉄骨造、ブロック造', '鉄骨造、木造、ブロック造', 'ＲＣ、鉄骨造、軽量鉄骨造'] %}
                        <option value="{{ structure }}" {% if structure == request.form['structure'] %}selected{% endif %}>{{ structure }}</option>
                        {% endfor %}
                    </select><br>
                    建ぺい率（％）: <input type="text" name="coverage" value="{{ request.form['coverage'] if 'coverage' in request.form else '' }}" required><br>
                    容積率（％）: <input type="text" name="volume_rate" value="{{ request.form['volume_rate'] if 'volume_rate' in request.form else '' }}" required><br>
                    建築年数: <input type="text" name="age" value="{{ request.form['age'] if 'age' in request.form else '' }}" required><br>
                    地区名:
                    <select id="city" name="city" required>
                        <option value="">请选择市区町村名</option>
                        {% for city in cities %}
                        <option value="{{ city }}" {% if city == selected_city %}selected{% endif %}>{{ city }}</option>
                        {% endfor %}
                    </select><br>
                    <select id="district" name="district" required>
                        <option value="">请选择地区名</option>
                        {% if selected_city %}
                            {% for district in city_to_districts[selected_city] %}
                            <option value="{{ district }}" {% if district == selected_district %}selected{% endif %}>{{ district }}</option>
                            {% endfor %}
                        {% endif %}
                    </select><br>
                    <button type="submit">PREDICT</button>
                </form>
                {% if prediction_text %}
                    <div class="prediction">
                        {{ prediction_text }}
                    </div>
                {% endif %}
            </div>
            <div class="result-container">
                {% if result %}
                    <div class="result">
                        <h3>History Price</h3>
                        <div class="table-container">
                            {{ result|safe }}
                        </div>
                    </div>
                {% else %}
                    <div class="result">
                        <h3>没有找到匹配的数据。</h3>
                    </div>
                {% endif %}
            </div>
        </div>
        <div class="charts-container">
            {% if chart_exists %}
            <div class="chart">
                <h2></h2>
                <img src="{{ url_for('static', filename='price_stats.png') }}" alt="Price Statistics" style="width: 100%;">
            </div>
            {% endif %}
        </div>
        <h3 class="footer-text">Created by WEI CHUANJUN</h3>
    </div>
</body>
</html>